{% extends "webplatformcompat/base.jinja2" %}

{% block head_title %}MDN Importer{% endblock %}
{% block body_title %}MDN Importer{% endblock %}

{% block quick_nav %}
<p><em>go back to <a href="{{ url('home') }}">home</a>, or
  see a <a href="{{ url('issues_summary') }}">summary of current issues</a>.
</em></p>
{% endblock %}

{% block content %}
<form class="form-inline" action="{{url("feature_page_search")}}" method="GET">
  <div class="form-group">
    <label class="sr-only" for="id-url">MDN URL</label>
    <input type="url" class="form-control" id="id-url" name="url"
     placeholder="https://developer.mozilla.org/en-US/docs/...">
  </div>
  <input id="fp-search" class="btn btn-primary" type="submit"
   value="Search or Filter by URL">
</form>

<h3>Filter by Topic </h3>
<div>
{% for topic_name in topics %}
{% if topic == topic_name %}
<a class="btn btn-primary"
   href="{{url('feature_page_list')}}">
  {{topic_name}} (clear)
</a>
{% else %}
<a class="btn btn-default"
   href="{{url('feature_page_list') + '?topic=' + topic_name}}">
  {{topic_name}}
</a>
{% endif %}
{% endfor %}
{% if topic and topic not in topics %}
<a class="btn btn-primary">{{topic}} (clear)</a>
{% endif %}
</div>

{% if page_obj %}
<h3>
    Import Results
    ({{page_obj.paginator.count}}
    import{% if page_obj.paginator.count > 1 %}s{% endif %})
</h3>
{{ pagination_control(page_obj, url('feature_page_list')) }}
<table class="table table-condensed">
  <thead>
    <tr>
      <th>MDN Slug</th>
      <th>Status</th>
      <th>
        <span id="issue-header"
              data-toggle="tooltip" data-placement="top"
              title="Warnings / Errors / Critical Errors">
          Issues
        </span>
      </th>
    </tr>
  </thead>
  <tbody>
    {% for page in page_obj.object_list %}
    <tr>
      <td>{{page.slug()}}</td>
      <td><a href="{{ url('feature_page_detail', pk=page.id) }}">{{page.get_status_display()}}</a></td>
      <td>
        <a href="{{ url('feature_page_detail', pk=page.id) }}">
        {%- if page.status == page.STATUS_PARSED -%}
          {%- if page.has_issues %}
            {{page.warnings}} / {{page.errors}} / {{ page.critical }}
          {% else %}
            No Issues
          {% endif %}
        {%- elif page.status == page.STATUS_NO_DATA %}
          No Data
        {%- elif page.status == page.STATUS_ERROR %}
          <strong>Scraping Failed</strong>
        {%- else %}
          <em>Still Processing</em>
        {%- endif -%}
        </a>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{{ pagination_control(page_obj, url('feature_page_list')) }}
{% else %}
<p><i>No pages imported yet.</i></p>
{% endif %}

{% if can_create_mdn_import(request.user) %}
<a class="btn btn-primary" href="{{url('feature_page_create')}}">Import a new page</a>
{% endif %}

{% endblock content %}

{% block block_js_extra %}
<script>
$(function () {
  $('#issue-header').tooltip()
})
</script>
{% endblock %}
